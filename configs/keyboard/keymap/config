xkb_keymap {
  xkb_keycodes { include "evdev" };

  xkb_types {
    include "basic"
    include "pc"
    include "numpad"

    type "Ctrl_type" {
      modifiers = Control+Shift;
      map[None] = Level1;
      map[Shift] = Level2;
      map[Control] = Level3;

      level_name[Level1] = "Base";
      level_name[Level2] = "Shift";
      level_name[Level3] = "Ctrl";
    };

    type "Alt_type" {
      modifiers = Shift+Mod5;
      map[None] = Level1;
      map[Shift] = Level2;
      map[Mod5] = Level3;
      level_name[Level1] = "Base";
      level_name[Level2] = "Shift";
      level_name[Level3] = "AltGr";
    };

  };

  xkb_compat {
    include "basic"
    include "ledscroll(group_lock)"
    augment "misc"
    augment "xfree86"

    interpret ISO_First_Group {
      action= LockGroup(group=1);
    };

    interpret ISO_Last_Group {
      action= LockGroup(group=3);
    };

    interpret Hyper_R {
      action= LockGroup(group=2);
    };

    interpret ISO_Level3_Shift {
      action= SetMods(modifiers=Mod5);
    };
  };

  xkb_symbols {
    include "pc+dv_layout"
    include "us_layout:2"
    include "ru_layout:3"

    include "inet(evdev)"
    include "terminate(ctrl_alt_bksp)"

    replace key <CAPS> {
      type = "Ctrl_type",
      [ ISO_First_Group, ISO_Last_Group, Hyper_R ]
    };

    replace key <RALT> {
      [ ISO_Level3_Shift, Caps_Lock ]
    };
    replace key <TAB> {
      [ ISO_Level3_Shift, Tab ]
    };
    modifier_map Mod5 { ISO_Level3_Shift };
  };

  xkb_geometry  { include "pc(pc105)" };
};
